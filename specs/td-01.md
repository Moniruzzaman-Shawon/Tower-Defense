# Tiny TD (TD-01)

## Goal
Single-map tower defense playable in a web browser. Enemies follow one fixed path from Start → Goal. Player places towers beside the path to stop them. Survive 10 waves.

## Platform & Tech
- Single page app: `index.html`, `style.css`, `game.js` (vanilla JS; no build tools)
- Canvas size: 800×500 (scale to fit window; preserve aspect)
- No images or audio; shapes and default font only
- Seeded RNG string: `"TDMINI"` (deterministic runs)
- Autosave to `localStorage` between waves and after placing/upgrading/selling towers. “Continue” option on load.

## Map
- Grid 20×12; tile size 40 px (so 20*40=800, 12*40=480 plus margins ok)
- **Path** (tile centers as polyline; convert to px):  
  `[(0,6),(5,6),(5,3),(12,3),(12,9),(19,9)]`
- Build rules: towers may be placed only on tiles **not** on the path and not overlapping another tower (min center distance 24 px).

## Player
- Start: **Lives** = 15, **Coins** = 100
- Lose 1 life per creep that reaches Goal; defeat at 0 lives.

## Towers
All ranges are in pixels; fire rate is shots/sec; projectile_speed in px/sec.

| id | name   | cost | range | dmg/shot | fire_rate | projectile_speed | aoe_radius | upgrade (tier 2)                |
|----|--------|------|-------|----------|-----------|------------------|------------|---------------------------------|
| T1 | Arrow  | 50   | 140   | 10       | 1.0       | 500              | 0          | +25% dmg, +20 range (cost 60)   |
| T2 | Cannon | 80   | 120   | 20       | 0.6       | 360              | 50         | +30% dmg, +10% aoe (cost 90)    |

- Targeting mode: **First** (creep with highest path progress). Keep target while in range.
- Sell value: **70%** of all coins spent on that tower (including upgrade).
- Mid-wave building allowed.

## Creeps
- Circle radius = 12 px; movement speed in tiles/sec.
- Base types (effective HP = baseHP × wave.hp_mult):

| id | name   | baseHP | speed | bounty |
|----|--------|--------|-------|--------|
| C1 | Grunt  | 30     | 1.2   | 5      |
| C2 | Runner | 20     | 2.0   | 5      |
| C3 | Tank   | 160    | 0.7   | 12     |

## Waves (10)
Spawn model: for each `[type, count]` spawn one creep every `spawn_rate` seconds, iterating through the wave’s lists.

1. spawn 0.90, mult 1.00 → `[Grunt×12]`  
2. 0.85, 1.10 → `[Grunt×8, Runner×6]`  
3. 0.80, 1.20 → `[Runner×10]`  
4. 0.80, 1.30 → `[Tank×6]`  
5. 0.75, 1.45 → `[Grunt×8, Tank×4]`  
6. 0.70, 1.60 → `[Runner×10, Grunt×6]`  
7. 0.70, 1.80 → `[Tank×8]`  
8. 0.65, 2.10 → `[Runner×12, Tank×6]`  
9. 0.60, 2.40 → `[Grunt×16, Tank×6]`  
10. 0.55, 3.00 → `[Tank×10]`

## Combat Rules
- Projectiles travel straight toward the current target; hit when distance ≤ creep radius.
- **AOE**: full damage to all creeps within `aoe_radius` of impact; no falloff.
- Coins +`bounty` on kill. No coin on leaks.

## UI / Controls
- HUD: Coins, Lives, `Wave X/10`, **Start Wave**, **Pause (P)**, **Speed ×1/×2 (F)**, **Clear Save**
- Build bar: buttons **Arrow (50)**, **Cannon (80)**; disabled if unaffordable
- Placement preview: highlight tile (green/red) + range circle
- Minimal tower panel on select: name, level, upgrade button (cost), sell button (shows refund)

## Acceptance Criteria
1. Can place Arrow/Cannon on valid tiles; invalid tiles are rejected with feedback.  
2. Start wave spawns creeps at the stated cadence and compositions; creeps follow the path to Goal.  
3. Towers acquire targets by “First”, fire at their fire_rate; Cannon applies AOE correctly.  
4. On kill: coins increase by bounty; on leak: lives decrease by 1.  
5. Upgrade applies multipliers; selling refunds **70%** of total spent.  
6. **Autosave** occurs between waves and after build/upgrade/sell; reload shows “Continue” and restores state.  
7. Victory when wave 10 completes; Defeat when lives reach 0.  
8. Renders at 60 FPS on a typical laptop with the given counts.


## Player & Leaderboard

### Player Name
- On first load, prompt the user for their name.
- Store the name in `localStorage` under key `"playerName"`.
- Display the name in the top-left HUD: `Player: <name>`.
- Add a “Change Name” button to allow re-entering a different name.

### Leaderboard
- Display a vertical leaderboard panel on the right side of the screen.
- Each record: player name, highest wave, score, date/time.
- Store data in `localStorage` under key `"leaderboard"`.
- When a run finishes (victory or defeat):
  - If player’s score is higher than their previous best, update it.
  - Sort all entries by descending score.
  - Keep only the top 10 records.
- Automatically refresh leaderboard display after every game end.

### Scoring Model
- Score = total coins earned + (remaining lives × 100) + (waveIndex × 200).
- Show final score on “Victory” or “Defeat” overlay.
- Send this score to the leaderboard update function.

## Visual & UI Enhancements

### Background
- Use a textured battlefield background: muted green-brown terrain with faint grid lines.
- Draw scattered terrain “patches” (darker rectangles or noise pattern) to suggest dirt and grass.
- Path tiles use a lighter dirt color (`#7b5e3b`), slightly raised visually.
- HUD right side: Leaderboard title “Top Commanders”.
- Leaderboard entries show rank number.

### Towers
- Arrow Tower: draw a round wooden base with a narrow triangle “arrow” that fires toward enemies.
- Cannon Tower: draw a metal gray circular base with a darker barrel rectangle pointing toward target.
- When firing, show a thin line or small circle projectile traveling to the creep.
- Use simple 2D shapes only (no external images).

### Creeps
- Grunts: green circles.
- Runners: blue circles.
- Tanks: dark gray circles with a lighter ring.

### HUD and Leaderboard
- On load, prompt for `playerName` (persist to localStorage).
- Show `Player: <name>` top-left, and a leaderboard on the right showing top 5 scores.
- Leaderboard persists between sessions under `leaderboard` key.

### Feel
- Smooth 60 FPS animation.
- Soft drop-shadow on towers.
- Slight projectile trail fade.
- Use the seeded RNG for visual variation (colors, tiny jitter).

